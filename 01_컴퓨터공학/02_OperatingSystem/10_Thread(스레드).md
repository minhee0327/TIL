# 10 Thread(스레드)
- Thread(스레드)
    - Light Weight Process 라고도 함
    - 프로세스
        - 프로세스간에는 각 프로세스의 데이터 접근이 불가
        - 프로세스간 커뮤니케이션 위해서는 IPC 기법 필요
    - 스레드
        - 하나의 프로세스에 여러개의 스레드 생성가능
        - 스레드들은 동시 실행 가능
        - 프로세스 안에 있으므로, 프로세스의 데이터들을 모두 접근 가능
        - IPC 사용할 필요 없음
    - 멀티 스레드
        - 소프트웨어 병행 작업 처리를 위해 멀티 스레드를 사용
        - 각 스레드의 CODE, DATA, HEAP영역을 서로 공유하고, thread Stack영역만 별도로 각 스레드가 가지고있다.

> 멀티 태스킹 / 멀티 프로세싱 / 멀티 스레드  
> 1. 멀티 태스킹: 단일 CPU에서 여려 프로세스를 실행시켜 동시에 실행되는 것 처럼 보임  
> 2. 멀티 프로세싱: 여러 CPU를 사용하여, 하나 이상의 프로세스를 빠르게 실행하여 속도를 높임   
> 3. 멀티 스레드: 하나의 프로세스를 여러개의 스레드를 사용  
> 따라서 최근 CPU는 멀티코어를 가지므로, 여러스레드를 만들어서 멀티 코어의 활용도를 높이고 있다.

- 스레드 장단점
    - 장점
        1. 사용자에 대한 응답성 향상
        2. 자원 (공유) 효율
            - IPC기법과 같이 프로세스간 자원공유를 위해 번거로운 작업 필요 X
            - 프로세스 안에 있으므로, 프로세스 데이터를 모두 접근가능
        3. 작업이 분리되어 코드가 간결
            - 이건 작성하기 나름이기는 함.
        4. CPU 활용도 높이고 성능을 개선할 수 있다.
    - 단점
        1. 스레드 중 하나의 스레드만 문제가 생기더라도 전체 프로세스가 영향을 받음
        2. 스레드 많이 생성시, Context Switching이 많이 일어나 성능 저하 일어날 수 있다.
            - 예: 리눅스 OS는 스레드를 프로세스와 같이 다룬다.
            - 따라서 스레드를 많이 생성할수록 모든 스레드에 대해 스케쥴링하면서 컨택스트 스위칭이 빈번할수밖에 없다.
    
- Process VS Thread 
    |Process|Thread|
    |:------:|:-------:|
    |프로세스는 독립적|스레드는 프로세스의 서브셋(종속되어있음)|
    |각각 독립적인 자원을 가짐|**프로세스의 자원 공유**|
    |자신만의 주소영역 가짐|주소영역 공유|
    |프로세스간 IPC기법 통신|IPC 기법 필요 없음|


- 스레드 동기화문제
    - 동기화(Synchronization)
        - 스레드의 실행순서는 정해진게 아니라, 스케쥴러에 따라 그때마다 다름
        - 그런데 한 프로세스 내부의 스레드들은 같은 데이터를 공유하고 있음
        - 그래서 순서가 꼬이면, 비정상 동작을 할 수 있음. 
        - 이 비정상 동작을 스레드 동기화라고 하기때문에 관리가 필요하다.
        - 정리:
            - 동기화: 작업들 사이에 실행시기를 맞추는 것.
            - 여러스레드가 동일한 자원(데이터) 접근시 동기화 이슈발생
                - 동일한 자원을 여러 스레드가 동시 수정시 각 스레드 결과에 영향(비정상 동작)을 준다.
        - 해결방법
            - **mutual exclusion(상호배제)**
            - 스레드는 프로세스 모든 데이터를 접근할 수 있으므로,
                - 여러스레드가 변경하는 공유변수에 대해 exclusive access필요
                - 어느 한 스레드가 공유변수를 갱신하는 동안 다른 스레드가 동시 접근하지 못하도록 막기
            
            - example02참조
                - 한번에 한 스레드만 공유자원에 엑세스하도록 만들어주면 해결(lock)
                    ```python
                    lock.acquire()
                    for i in range(100000):
                        g_count +=1  #임계자원
                    lock.release()
                    ```
                - 임계영역(critical section): 동시 실행하면 안되는 영역
                - 임계자원(critical resource): 동시 수정하면 안되는 자원(g_count)

- Mutex와 세마포어(Semaphore)
    - Critical Section(임계 영역) 에 대한 접근을 막기 위해 Locking 매커니즘이 필요
        - Mutex(binary semaphore)
            - 임계 구역에 하나의 스레드만 들어갈 수 있음
            - 한 쓰레드, 프로세스에 의해 소유될 수 있는 Key를 기반으로 한 상호배제기법
        - Semaphore
            - 임계구역에 여러 스레드가 들어갈 수 있음
            - counter를 두어 동시에 리소스에 접근할 수 있는 허용가능한 스레드 수 제어
            - 현재 공유자원에 접근할 수 있는 쓰레드, 프로세스의 수를 나타내는 값을 두어 상호배제를 달성하는 기법
        - [참고자료](https://worthpreading.tistory.com/90)
